function downloadCanvas(e,n,a){e.href=document.getElementById(n).toDataURL(),e.download=a}function loadImage(e){var n=new FileReader;n.onload=function(e){img.setAttribute("crossOrigin","anonymous"),$(img).error(function(){console.log("Sorry, image provided doesn't work")}),img.onload=function(){imgloaded=!0,ctx.clearRect(0,0,c.width,c.height),ctx.drawImage(img,0,0,800,800),img2.src=overlay[$("#otype").find("input").index($("#otype").find(":checked"))]},img.src=e.target.result},n.readAsDataURL(e.target.files[0])}var c,ctx,overlay=new Array("images/ContentCensored.jpg","images/GlobalAlly.jpg"),img2=new Image,img=new Image,imgloaded=!1;$(document).ready(function(){$("#otype").on("change",function(){imgloaded===!0&&(ctx.drawImage(img,0,0,800,800),img2.src=overlay[$("#otype").find("input").index($("#otype").find(":checked"))])}),c=document.getElementById("maincanvas"),ctx=c.getContext("2d"),img2.onload=function(){ctx.drawImage(img2,0,250),$("#output").empty(),$("#output").append('<img src="'+c.toDataURL()+'">'),$("#output").fadeIn("fast").css("display","block"),$("#dlImage").fadeIn("fast").css("display","inline-block")};var e=document.getElementById("fileupload");e.addEventListener("change",loadImage,!1),$("#dlImage").on("click",function(){console.log("go"),downloadCanvas(this,"maincanvas","globalAlly.png")})});